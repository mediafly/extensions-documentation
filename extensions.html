<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>extensions</title>



</head>

<body>

<p><img src="./images/interactives-API-logo.png" alt="image"></p>

<h1 id="toc_0">Overview</h1>

<p>Customers often wish to create rich, engaging content that include advanced UI effects, form entry, dynamic content, and more features that extend well beyond the limitations of PowerPoint or PDFs. With Mediafly Extensions and the Mediafly Platform, customers can create, release and control these packages.  This document serves as documentation for how a customer can create an Extension and what best practices exist in their creation and maintenance.</p>

<hr>

<h2 id="toc_1">What are Extensions?</h2>

<p>Extensions are all the components that make up a static website:</p>

<ul>
<li>HTML files</li>
<li>JavaScript</li>
<li>CSS</li>
<li>Fonts</li>
<li>Images</li>
</ul>

<p>All of these files are packaged up in a specific way and uploaded to Mediafly Airship. These packages have the extension of <code>.extension</code>. Note: Packaging Extensions with the <code>.zip</code> is now obsolete and Viewer no longer supports this file extension for Extensions.</p>

<p>When the user opens the Extension, the app loads and renders the Extension much like it would a traditional web page.
<img src="http://devdocs.mediafly.com/interactives/images/Interactives%20Overview.png" alt="image"></p>

<p>To ensure that the apps work consistently and correctly, the Extension developer needs to follow a few rules:</p>

<ul>
<li>The starting page must be named index.html .  This is the common starting point from which any package can launch.  Sub-pages are acceptable, as long as they are navigable from index.html.</li>
<li><p>Apps that reference third-party libraries (e.g. jQuery, jQuery Mobile, Reveal.js, Angular.JS) should relatively reference those files from the pages.  To be able to function while offline (for iOS and Android) no files should be absolutely referenced to a site on the web.  For example, an index.html file that contains the following is acceptable, because the files are relatively referenced:</p>

<div><pre><code class="language-none">&lt;script src=&quot;js/jquery.min.js&quot;&gt;&lt;/script&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;css/main.css&quot;&gt;</code></pre></div>

<p>and an index.html file containing the following is not acceptable for offline use, because the files are absolutely referenced.</p>

<div><pre><code class="language-none">&lt;script src=&quot;http://code.jquery.com/jquery-1.8.2.min.js&quot;&gt;&lt;/script&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;http://mediafly.com/css/main.css&quot;&gt;</code></pre></div></li>
</ul>

<hr>

<h2 id="toc_2">Communication between the App and Extension</h2>

<p>Extensions are single page applications. They allow for deep customization of the entire look and feel of the application. Because Extensions make use of the entire screen, Mediafly’s apps need to be told when to close the Extension as well as when to show other content.  The typical approach to this is:</p>

<ol>
<li>The Extension will provide a Menu or X button in the app.</li>
<li>When the user taps/clicks on the Menu button, notify the app to close the Extension</li>
<li>The app will close the Extension and navigate to other content where the user can resume their workflow.</li>
</ol>

<p>Extensions can link to other items within the hierarchy.  For example, if a user has access to one Extension and three other items (video, audio, documents, presentations, even other Extensions), the Extension can link directly to those items. </p>

<p>Extensions can invoke capabilities provided by the app such as Search and Collections as well.</p>

<hr>

<h1 id="toc_3">Building Extensions</h1>

<h2 id="toc_4">Developing and testing an Extension</h2>

<p>Mediafly provides a CLI (command line interface) utility called <code>mfly-interactive</code> to make it easier to test and develop an Extension. <code>mfly-interactive</code> allows an Extension developer to:</p>

<ol>
<li>Rapidly develop Extensions by live-reloading changes from the developer&#39;s machine.</li>
<li>Generate the <code>.extension</code> package from static files.</li>
<li>Upload the Extension into Airship.</li>
</ol>

<p>For more detailed instructions, refer to https://github.com/mediafly/mfly-interactive.</p>

<p>Note: You will need the <a href="https://nodejs.org/en/download/">Node.js</a> runtime (v5 or higher) to use <code>mfly-interactive</code>. <code>mfly-interactive</code> is currently only supported on Viewer and iOS.</p>

<h2 id="toc_5">Testing on device</h2>

<h3 id="toc_6">weinre</h3>

<p>We strongly recommend the use of <a href="http://people.apache.org/%7Epmuellr/weinre-docs/latest/">weinre</a>, the WEb INspector REmote. It is a debugger for remote web pages, and in particular, it <i>allows you to debug web pages on mobile devices with your laptop</i>.</p>

<h4 id="toc_7">How to use it</h4>

<p>Please read the <a href="http://people.apache.org/%7Epmuellr/weinre-docs/latest/Installing.html">installation</a> and <a href="http://people.apache.org/%7Epmuellr/weinre-docs/latest/Running.html">run</a> instructions on the website for details. But here is a simple overview:</p>

<ol>
<li>Install the tool via npm, (e.g. npm -g install weinre)</li>
<li>Run the debug server locally (e.g. weinre —boundHost 10.0.0.111)</li>
<li>Update the Extension with a <code>&lt;script&gt;</code> tag to point to the debug server, and publish the new Extension in Airship (e.g. <code>&lt;script src=&quot;http://10.0.0.111:8080/target/target-script-min.js&quot;&gt;&lt;/script&gt;</code>). Open the Extension on your app</li>
<li>Point your PC/Mac browser to the debug client (e.g. http://10.0.0.111:8080)</li>
</ol>

<p>You now have access to a relatively full featured web development tool for your Extensions!</p>

<hr>

<h2 id="toc_8">Examples and Resources</h2>

<h3 id="toc_9">Examples</h3>

<p>Mediafly creates and maintains a detailed list of examples. These examples illustrate many of the features of Extensions and can serve as QA for client app developers.</p>

<p>Please see the <a href="https://bitbucket.org/mediafly/mediafly-interactives-tools-and-examples">Mediafly Extensions Tools and Examples</a> BitBucket repository for more information.</p>

<p>To see the examples in action on your device:</p>

<ol>
<li>Download Whitebox for <a href="https://itunes.apple.com/us/app/whitebox/id399107683?mt=8">iOS</a>, <a href="https://play.google.com/store/apps/details?id=com.mediafly.android.video.onmediafly&amp;hl=en">Android</a> or <a href="http://apps.microsoft.com/windows/en-us/app/39a96812-56fa-4583-82eb-4d787fda0d4c">Windows 8</a></li>
<li>When asked for Company Code or Company Login Name, enter &quot;extensions&quot;</li>
<li>Each example will be contained within a folder that describes the example</li>
</ol>

<h3 id="toc_10">Google Group</h3>

<p>Please <a href="https://groups.google.com/forum/?hl=en#!forum/mediafly-interactives">join our Google Group</a> to keep up with the latest information, udates and news. As well, learn from and get help from other Extensions builders and customers.</p>

<h3 id="toc_11">Changelog</h3>

<p>Please see the <a href="https://bitbucket.org/mediafly/mediafly-interactives-documentation/commits/all">repository</a> of this document for a changelog.</p>

<h3 id="toc_12">Feedback</h3>

<p>See an area of confusion? Please <a href="mailto:support@mediafly.com?Subject=Interactives%20Documentation%20Feedback">contact us</a>.</p>

<hr>

<h1 id="toc_13">API and Howtos</h1>

<p>This section describes all of the APIs available to Extensions developers. For each call, we list the mflyCommands.js call as well as the base URL. Please use the mflyCommands.js call where possible.</p>

<p><em>A note on &#39;Availability&#39;:</em> You will see many API calls have no version numbers within the Availability column. In these cases, the calls have been in existence for a sufficiently long period of time that Extensions developers no longer need to worry about whether their clients&#39; apps support those calls anymore.</p>

<p><em>Keeping mflyCommands up-to-date:</em> mflyCommands.js is available on the <a href="http://bower.io/">bower package manager</a>. This is the recommended way of consuming it as a dependency in your Extension. The bower package can be found here: <a href="http://bower.io/search/?q=mfly-commands">http://bower.io/search/?q=mfly-commands</a></p>

<h2 id="toc_14">Communicating with the app</h2>

<p>Communicating the app is done by calling functions on mflyCommands. The list of available functions, and their appropriate actions, are listed below.</p>

<p><strong><em>PLEASE NOTE</em></strong>: Every Extension must allow the user to close the item. Else, the user will be stuck within the Extension, with no way to exit.</p>

<h3 id="toc_15">Getting baseline information</h3>

<p><em>mflyCommands.js:</em> mflyCommands.getInteractiveInfo() <br>
<em>Description:</em> Obtains baseline information about this Extension. Extensions can call this function and receive an object of initial configuration. Response example:</p>

<div><pre><code class="language-none">    {
        &quot;user&quot;: &quot;jshah@mediafly.com&quot;,
        &quot;displayName&quot;: &quot;John Doe&quot;,
        &quot;item&quot;: &quot;Custom Dynamic Extension 1.2&quot;,
        “id”: “29342938241238product234234”,
        &quot;osType&quot;: &quot;iOS&quot;,
        &quot;osVersion&quot;: &quot;6.1.2&quot;,
        &quot;appVersion&quot;: &quot;6.1.4.405&quot;,
        &quot;deviceId&quot;: &quot;4639ufu115f0630a13a8744e8b5cc6309b46&quot;,
        &quot;lastUpdated&quot;: &quot;2014-02-03T07:04:07-06:00&quot;
    }</code></pre></div>

<p><em>Parameters:</em><br></p>

<ul>
<li>user: The system&#39;s username, if any</li>
<li>displayName: display name. Can be email, first+last, or something similar. May be blank in the case of content libraries that don&#39;t require logging in</li>
<li>item: title of this Extension</li>
<li>id: the slug (unique id) of this Extension within Airship</li>
<li>osType: which OS (iOS, Android, Windows 8)</li>
<li>osVersion: which version of the OS</li>
<li>appVersion: which version of the app</li>
<li>deviceId: the unique device ID for this device</li>
<li>lastUpdated: the lasted updated time. This is good for debugging purposes, to help you identify which version of the Extension you are looking at on the device</li>
</ul>

<p>Note that not every parameter is available on every platform.</p>

<p><em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<h3 id="toc_16">Basic controls</h3>

<h4 id="toc_17">Close the item</h4>

<p><em>mflyCommands.js:</em> mflyCommands.close() <br>
<em>Description:</em> Closes the item and returns the user to where they were before. <br>
<em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<h4 id="toc_18">Show control bars</h4>

<p><em>mflyCommands.js:</em> mflyCommands.showControlBars() <br>
<em>Description:</em> Shows the control bars. <br>
<em>Availability:</em> iOS, Android</p>

<h4 id="toc_19">Hide control bars</h4>

<p><em>mflyCommands.js:</em> mflyCommands.hideControlBars() <br>
<em>Description:</em> Hides the control bars. <br>
<em>Availability:</em> iOS, Android</p>

<h4 id="toc_20">Browse (<em>deprecated</em>)</h4>

<p><em>mflyCommands.js:</em> mflyCommands.browse() <br>
<em>Description:</em> Multiple Extensions can layer on top of each other, to represent different layers of hierarchy. The developer may wish to allow the user to navigate the hierarchy using the core Mediafly app with the default grid/list view, e.g. if a “More” or “Browse” button is presented.  This URL closes all Extensions in the stack and takes the user to that hierarchy in the core app if called. <br>
<em>Availability:</em> iOS</p>

<h4 id="toc_21">Next</h4>

<p><em>mflyCommands.js:</em> mflyCommands.next() <br>
<em>Description:</em> Opens the next Item in the Folder or Collection <br>
<em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<h4 id="toc_22">Previous</h4>

<p><em>mflyCommands.js:</em> mflyCommands.previous() <br>
<em>Description:</em> Opens the previous Item in the Folder or Collection <br>
<em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<h4 id="toc_23">Get information about a folder or item</h4>

<p><em>mflyCommands.js:</em> mflyCommands.getItem(<em>id</em>) <br>
<em>Description:</em> Return a JSON representation of a folder or item. To get the contents of the folder, rely on the mflyCommands.getFolder(<em>id</em>) <br>
<em>Examples:</em></p>

<div><pre><code class="language-none">Example 1:
    Result:
    {
        &quot;id&quot;: &quot;slug1&quot;,
        &quot;url&quot;: &quot;mfly://item/slug1&quot;,
        &quot;type&quot;: &quot;video&quot;,
        &quot;name&quot;: &quot;Name&quot;,
        &quot;description&quot;: &quot;Description&quot;,
        &quot;date&quot;: &quot;2010-11-12T06:15:15:00-06:00&quot;,
        &quot;received&quot;: &quot;2012-12-19T16:45:14:00-06:00&quot;,
        &quot;thumbnailUrl&quot;: &quot;mfly://image/123&quot;,
        &quot;launched&quot;: &quot;true&quot;,
        “keywords”: [“keyword4”],
        &quot;bookmark&quot;: 45,
        &quot;length&quot;: 596,
        &quot;hierarchy&quot;: [
        {
            &quot;id&quot;: &quot;__root__&quot;,
            &quot;name&quot;: &quot;Root folder&quot;
        },
        {
            &quot;id&quot;: &quot;9cf282320e6340ee8b830e5376d54531product91921&quot;,
            &quot;name&quot;: &quot;Parent Folder&quot;
        }]
    }


Example 2:
    GET mfly://data/item/slug2
    Result:
    {
        &quot;id&quot;: &quot;slug2&quot;,
        &quot;url&quot;: &quot;mfly://item/slug2&quot;,
        &quot;type&quot;: &quot;folder&quot;,
        &quot;name&quot;: &quot;Name&quot;,
        &quot;description&quot;: &quot;Description&quot;,
        &quot;date&quot;: &quot;2010-11-12T06:15:15:00-06:00&quot;,
        &quot;received&quot;: &quot;2012-12-19T16:45:14:00-06:00&quot;,
        &quot;thumbnailUrl&quot;: &quot;mfly://image/123&quot;,
        &quot;launched&quot;: &quot;false&quot;,
        “keywords”: [“keyword1”, “keyword2”, “keyword3”],
        “new”: 1,
        &quot;hierarchy&quot;: [
        {
            &quot;id&quot;: &quot;__root__&quot;,
            &quot;name&quot;: &quot;Root folder&quot;
        }]
    }</code></pre></div>

<p><em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<h4 id="toc_24">Get contents of a folder</h4>

<p><em>mflyCommands.js:</em> mflyCommands.getFolder(<em>id</em>) <br>
<em>Description:</em> Return a JSON representation of the <em>contents</em> of a folder. To get the contents of the top-level folder, use id of _<em>root</em>_.</p>

<div><pre><code class="language-none">Example:
    Result:
    [
      {
        &quot;id&quot;: &quot;slug3&quot;,
        &quot;url&quot;: &quot;mfly://item/slug3&quot;,
        &quot;type&quot;: &quot;video&quot;,
        &quot;name&quot;: &quot;Name&quot;,
        &quot;description&quot;: &quot;Description&quot;,
        &quot;date&quot;: &quot;2010-11-12T06:15:15:00-06:00&quot;,
        &quot;received&quot;: &quot;2012-12-19T16:45:14:00-06:00&quot;,
        &quot;thumbnailUrl&quot;: &quot;mfly://image/123&quot;,
        &quot;launched&quot;: &quot;true&quot;,
        “keywords”: [“keyword4”],
        &quot;bookmark&quot;: 45,
        &quot;length&quot;: 596,
        &quot;hierarchy&quot;: [
        {
            &quot;id&quot;: &quot;__root__&quot;,
            &quot;name&quot;: &quot;Root folder&quot;
        },
        {
            &quot;id&quot;: &quot;9cf282320e6340ee8b830e5376d54531product91921&quot;,
            &quot;name&quot;: &quot;Parent Folder&quot;
        }]
      },
      {
        &quot;id&quot;: &quot;slug4&quot;,
        “items”: [“slug5”],
        &quot;url&quot;: &quot;mfly://folder/slug4&quot;,
        &quot;type&quot;: &quot;folder&quot;,
        &quot;name&quot;: &quot;Name&quot;,
        &quot;description&quot;: &quot;Description&quot;,
        &quot;date&quot;: &quot;2010-11-12T06:15:15:00-06:00&quot;,
        &quot;received&quot;: &quot;2012-12-19T16:45:14:00-06:00&quot;,
        &quot;thumbnailUrl&quot;: &quot;mfly://image/123&quot;,
        &quot;launched&quot;: &quot;false&quot;,
        &quot;hierarchy&quot;: [
        {
            &quot;id&quot;: &quot;__root__&quot;,
            &quot;name&quot;: &quot;Root folder&quot;
        },
        {
            &quot;id&quot;: &quot;9cf282320e6340ee8b830e5376d54531product91921&quot;,
            &quot;name&quot;: &quot;Parent Folder&quot;
        }]
      }
    ]</code></pre></div>

<p><em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<h3 id="toc_25">App features</h3>

<h4 id="toc_26">Show Settings</h4>

<p><em>mflyCommands.js:</em> mflyCommands.showSettings(<em>x-coord, y-coord, width, height</em>) <br>
<em>Description:</em> Shows the settings dialog at x-coord, y-coord coordinates with the specified width and height. <br>
<em>Availability:</em> iOS, Android</p>

<h4 id="toc_27">Show User Management Dialog</h4>

<p><em>mflyCommands.js:</em> mflyCommands.showUserManagement(<em>x-coord, y-coord, width, height</em>) <br>
<em>Description:</em> Shows the User Management dialog, which allows the user to login or manage users. Parameters x-coord, y-coord, width, and height are all optional, and only work with iOS.<br>
<em>Availability:</em> iOS, Android</p>

<h4 id="toc_28">Show Second Screen Options dialog</h4>

<p><em>mflyCommands.js:</em> mflyCommands.showSecondScreenOptions() <br>
<em>Description:</em> Shows the Second Screen Options dialog. <br>
<em>Availability:</em> iOS</p>

<h4 id="toc_29">Email</h4>

<p><em>mflyCommands.js:</em> mflyCommands.email(<em>id</em>) <br>
<em>Description:</em> If the item can be emailed, invoke email from within the app. <br>
<em>Availability:</em> iOS, Android</p>

<h4 id="toc_30">Refresh the contents of the app</h4>

<p><em>mflyCommands.js:</em> mflyCommands.refresh() <br>
<em>Description:</em> Trigger the app to refresh its content. If items have changed, this should trigger mflySync calls appropriately. <br>
<em>Availability:</em> iOS, Android</p>

<h4 id="toc_31">Show Annotations</h4>

<p><em>mflyCommands.js:</em> mflyCommands.showAnnotations() <br>
<em>Description:</em> If annotations are enabled, show the annotations control bar. <br>
<em>Availability:</em> iOS</p>

<h4 id="toc_32">Take and email Screenshot</h4>

<p><em>mflyCommands.js:</em> mflyCommands.takeAndEmailScreenshot() <br>
<em>Description:</em> App will take a screenshot and populate the email with that screenshot. <br>
<em>Availability:</em> iOS</p>

<h4 id="toc_33">Open URL in a new Window</h4>

<p><em>mflyCommands.js:</em> mflyCommands.openWindow(url) <br>
<em>Description:</em> Web Viewer will use open the URL in a new browser tab. Win/Mac app will open the URL in a new native window. <br>
<em>Availability:</em> Web Viewer, Win/Mac. Requires mflyCommands.js 1.13.0+.</p>

<h3 id="toc_34">Links (Open and Goto)</h3>

<p>Two types of links exist within Extensions: Open and Goto. When an Extension &quot;opens&quot; an item, the item appears on top of the navigational stack, and the user is only given a single option to escape the item, by tapping Done/Close.  When an Extension &quot;gotos&quot; an item, the app opens that item and throws away the navigational stack behind it. The user is given the same navigational capabilities as if they opened the destination item directly.</p>

<p>To create either link, simply create a typical <code>&lt;a href&gt;</code> link with the source pointing to an mfly URL as specified below.</p>

<h4 id="toc_35">Open an item</h4>

<p><em>mflyCommands.js:</em> mflyCommands.openItem(<em>id</em>) <br>
<em>Description:</em> Opens the specified item, where [id] is the ID of the item.  As described above, the historical navigational stack is maintained, and the user can return to it. The ID for an item can be found in Airship. Expand the item, and the ID is displayed at the bottom. <br>
<em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<h4 id="toc_36">Open a folder</h4>

<p><em>mflyCommands.js:</em> mflyCommands.openFolder(<em>id</em>) <br>
<em>Description:</em> Opens the specified folder, where [id] is the ID of the folder.  As described above, the historical navigational stack is maintained, and the user can return to it. The ID for a folder can be found in Airship. Expand the item, and the ID is displayed at the bottom. <br>
<em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<h4 id="toc_37">Goto an item or a folder (<em>deprecated</em>)</h4>

<p><em>mflyCommands.js:</em> mflyCommands.goto(<em>id</em>) <br>
<em>Description:</em> Gotos the specified item or folder, where [id] is the ID of the item or folder.  As described above, when the app goes to another item or folder, the navigational stack behind the destination is thrown away, and the user is given the same navigational capabilities as if they opened the destination item directly. The ID for a folder can be found in Airship. Expand the item, and the ID is displayed at the bottom. <br>
<em>Availability:</em> iOS, Android</p>

<h3 id="toc_38">Filter</h3>

<p>We often find that developers need to identify folders and items that match a specific set of metadata. Often they want to use custom metadata fields as a way to drive hierarchy and categorization, and not rely on the actual hierarchy for that purpose. It makes sense in some use cases, because the people who will be managing content are often different from how the Extension should be rendered.</p>

<p>To support this, use Filter. Filter accepts up to three key=value pairs as JSON parameters, and returns a constrained list of folders and items that match ALL of the key=value pairs provided. The return value is a JSON Array of JSON Objects that match the various folders and items with the specified filter conditions, or an empty JSON Array if none match.</p>

<p><em>mflyCommands.js:</em> mflyCommands.filter(<em>obj</em>) <br>
Examples:</p>

<div><pre><code class="language-none">Example 1:

    mflyCommands.filter({ &quot;shouldShow&quot;: false }).done(function(results) {
        // results contains, e.g.
        // [ { &quot;id&quot;: &quot;123&quot;, &quot;shouldShow&quot;: true, ... },
        //   { &quot;id&quot;: &quot;234&quot;, &quot;shouldShow&quot;: false, ... } ]
    });

Example 2:

    mflyCommands.filter({ &quot;shouldShow&quot;: false, &quot;key&quot;: &quot;doesNotExist&quot; }).done(function(results) {
        // results contains, e.g.
        // []
    });</code></pre></div>

<p><em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<h3 id="toc_39">Search</h3>

<p>Mediafly&#39;s apps provide real-time, native search as a core part of the functionality. There are two ways to work with Search:</p>

<ol>
<li>Use the native app&#39;s core Search UI. In this case, you simply need to open the Search dialog and let the user use that dialog. See &quot;Show Search dialog&quot; below.</li>
<li>Implement your own UI. In this case, you use the mflyCommands.search() call to get search results given terms, and then render the UI as you wish. See &quot;Search by keyword&quot; below.</li>
</ol>

<h4 id="toc_40">Show Search dialog (<em>deprecated</em>)</h4>

<p><em>mflyCommands.js:</em> mflyCommands.showSearch(<em>x-coord, y-coord, width, height</em>) <br>
<em>Description:</em> Shows the search dialog at x-coord, y-coord coordinates with the specified width and height. Parameters x-coord, y-coord, width, and height are all optional, and only work with iOS. <br>
<em>Availability:</em> iOS</p>

<h4 id="toc_41">Search by keyword</h4>

<p><em>mflyCommands.js:</em> mflyCommands.search(<em>term</em>) <br>
<em>Description:</em> Conduct a search for the given keyword. Return value is a JSON-array of folders and items.<br>
<em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<h3 id="toc_42">Get Recently Created Content</h3>

<p>You can use this call to get a list of content that was recently created for the user.</p>

<p><em>mflyCommands.js:</em> mflyCommands.getRecentlyCreatedContent() <br>
<em>Description:</em> Returns a JSON respresentation of the recently created content. <br>
<em>Availability:</em> iOS, Android, Web Viewer, Win/Mac <br>
<em>Note:</em> This call is only available when the device is online</p>

<h3 id="toc_43">Get Recently Viewed Content</h3>

<p>You can use this call to get a list of content that was recently viewed by the user. This list is limited to the last 50 items viewed by the user.</p>

<p><em>mflyCommands.js:</em> mflyCommands.getLastViewedContent() <br>
<em>Description:</em> Returns a JSON respresentation of the last 50 items viewed by the user. <br>
<em>Availability:</em> iOS, Android, Web Viewer, Win/Mac <br>
<em>Note:</em> This call is only available when the device is online</p>

<h3 id="toc_44">Copy Item</h3>

<p>You can use this call to copy an item to the desired folder in the hierarchy and optionally provide a new name for the copied item.</p>

<p><em>mflyCommands.js:</em> mflyCommands.copy(folderId, id, newName) <br>
<em>Description:</em> Copies an item. <br>
<em>Availability:</em> iOS, Android, Web Viewer, Win/Mac <br>
<em>Note:</em> This call is only available when the device is online</p>

<h3 id="toc_45">Update Item Metadata</h3>

<p>You can use this call to update metadata fields of an item.</p>

<p><em>mflyCommands.js:</em> mflyCommands.updateItemMetadata(id, metadataJson) <br>
<em>Description:</em> Update metadata fields of an item. <br>
<em>Example:</em></p>

<div><pre><code class="language-none">mflyCommands.updateItemMetadata(&#39;123&#39;, { field1: &#39;value1&#39; })</code></pre></div>

<p><em>Availability:</em> iOS, Android, Web Viewer, Win/Mac <br>
<em>Note:</em> This call is only available when the device is online</p>

<h3 id="toc_46">Collections</h3>

<div><pre><code class="language-none">Collections allow users to create a &quot;personal playlist&quot; of items. Oftentimes this is used as a way to organize items for, say, an upcoming meeting with a customer. Collections are pointers to items, not copies of items; updating the original item in Airship will update the item in the Collection as well.</code></pre></div>

<h4 id="toc_47">Show &quot;Collections&quot; (<em>deprecated</em>)</h4>

<p><em>mflyCommands.js:</em> mflyCommands.showCollections(<em>x-coord, y-coord, width, height</em>) <br>
<em>Description:</em> Shows the Collections dialog at x-coord, y-coord coordinates with specified width and height. Parameters x-coord, y-coord, width, and height are all optional, and only work with iOS.<br>
<em>Availability:</em> iOS, Android</p>

<h4 id="toc_48">Show &quot;Add to Collection&quot; (<em>deprecated</em>)</h4>

<p><em>mflyCommands.js:</em> mflyCommands.showAddToCollection(itemId, <em>x-coord, y-coord, width, height</em>) <br>
<em>Description:</em> Shows the Add To Collections dialog at x-coord, y-coord coordinates with specified width and height for the specified item. Parameters x-coord, y-coord, width, and height are all optional, and only work with iOS. <br>
<em>Availability:</em> iOS</p>

<h4 id="toc_49">Get the list of Collections</h4>

<p><em>mflyCommands.js:</em> mflyCommands.getCollections() <br>
<em>Description:</em> Return a JSON representation of the list of Collections</p>

<div><pre><code class="language-none">Example:
    Result:
    [
      {
        &quot;id&quot;: &quot;collection1&quot;,
        &quot;name&quot;: &quot;Collection 1&quot;
      },
      {
        &quot;id&quot;: &quot;collection2&quot;,
        &quot;name&quot;: &quot;Collection 2&quot;
      }
    ]</code></pre></div>

<p><em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<h4 id="toc_50">Get the contents of a Collection</h4>

<p><em>mflyCommands.js:</em> mflyCommands.getCollection(<em>collection ID</em>) <br>
<em>Description:</em> Return a JSON representation of the contents of a collection, in a similar format to Get Folder.</p>

<div><pre><code class="language-none">Example:
    mflyCommands.getCollection(&quot;collection1&quot;);
    Result:
    [
      {
        &quot;id&quot;: &quot;slug1&quot;,
        &quot;url&quot;: &quot;mfly://item/slug1&quot;,
        &quot;type&quot;: &quot;video&quot;,
        &quot;name&quot;: &quot;Name&quot;,
        &quot;description&quot;: &quot;Description&quot;,
        &quot;date&quot;: &quot;2010-11-12T06:15:15:00-06:00&quot;,
        &quot;received&quot;: &quot;2012-12-19T16:45:14:00-06:00&quot;,
        &quot;thumbnailUrl&quot;: &quot;mfly://image/123&quot;,
        &quot;launched&quot;: &quot;true&quot;,
        “keywords”: [“keyword4”],
        &quot;bookmark&quot;: 45,
        &quot;length&quot;: 596,
        &quot;hierarchy&quot;: [
        {
            &quot;id&quot;: &quot;__root__&quot;,
            &quot;name&quot;: &quot;Root folder&quot;
        },
        {
            &quot;id&quot;: &quot;9cf282320e6340ee8b830e5376d54531product91921&quot;,
            &quot;name&quot;: &quot;Parent Folder&quot;
        }]
      },
      {
        &quot;id&quot;: &quot;slug2&quot;,
        &quot;url&quot;: &quot;mfly://folder/slug3&quot;,
        &quot;type&quot;: &quot;pdf&quot;,
        &quot;name&quot;: &quot;Name&quot;,
        &quot;description&quot;: &quot;Description&quot;,
        &quot;date&quot;: &quot;2010-11-12T06:15:15:00-06:00&quot;,
        &quot;received&quot;: &quot;2012-12-19T16:45:14:00-06:00&quot;,
        &quot;thumbnailUrl&quot;: &quot;mfly://image/123&quot;,
        &quot;launched&quot;: &quot;false&quot;,
        &quot;bookmark&quot;: 4,
        &quot;length&quot;: 38
        &quot;hierarchy&quot;: [
        {
            &quot;id&quot;: &quot;__root__&quot;,
            &quot;name&quot;: &quot;Root folder&quot;
        },
        {
            &quot;id&quot;: &quot;9cf282320e6340ee8b830e5376d54531product91921&quot;,
            &quot;name&quot;: &quot;Parent Folder&quot;
        }]
      }
    ]</code></pre></div>

<p><em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<h4 id="toc_51">Create a Collection</h4>

<p><em>mflyCommands.js:</em> mflyCommands.createCollection(<em>collection name</em>) <br>
<em>Description:</em> Creates the collection, and returns a success or failure error code.</p>

<div><pre><code class="language-none">Example:
    mflyCommands.createCollection(&quot;Collection 2&quot;);
    Result:
    {
        &quot;id&quot;: &quot;collection2id&quot;,
        &quot;name&quot;: &quot;Collection 2&quot;
    }</code></pre></div>

<p><em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<h4 id="toc_52">Add item to a Collection</h4>

<p><em>mflyCommands.js:</em> mflyCommands.addItemToCollection(<em>collection ID</em>, <em>item ID</em>) <br>
<em>Description:</em> Adds the item to the Collection. If Collection exists and it can be created, response code is 200. If Collection does not exist, response code is 404 with body { &quot;message&quot;: &quot;Collection not found.&quot; }. If item does not exist, response code is 404 with body &quot;Item not found.&quot;</p>

<div><pre><code class="language-none">Example:
    mflyCommands.addItemToCollection(&quot;collection2id&quot;, &quot;item4id&quot;);</code></pre></div>

<p><em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<h4 id="toc_53">Remove item from a Collection</h4>

<p><em>mflyCommands.js:</em> mflyCommands.removeItemFromCollection(<em>collection ID</em>, <em>item ID</em>) <br>
<em>Description:</em> Removes the item from the Collection. If Collection does not exist, response code is 404 with body { &quot;message&quot;: &quot;Collection not found.&quot; }. If item does not exist, response code is 404 with body &quot;Item not found.&quot;</p>

<div><pre><code class="language-none">Example:
    mflyCommands.removeItemFromCollection(&quot;collection2id&quot;, &quot;item4id&quot;);</code></pre></div>

<p><em>Availability:</em>  iOS, Android, Web Viewer, Win/Mac</p>

<h4 id="toc_54">Delete a Collection</h4>

<p><em>mflyCommands.js:</em> mflyCommands.deleteCollection(<em>collection ID</em>, <em>shared</em>) <br>
<em>Description:</em> Deletes the Collection. If Collection does not exist, response code is 404 with body { &quot;message&quot;: &quot;Collection not found.&quot; }.</p>

<div><pre><code class="language-none">Example:
    GET mflyCommands.deleteCollection(&quot;collection2id&quot;, false);</code></pre></div>

<p><em>Availability:</em>  iOS, Android, Web Viewer, Win/Mac</p>

<h4 id="toc_55">Reorder an item in a Collection</h4>

<p><em>mflyCommands.js:</em> mflyCommands.reorderItemInCollection(<em>collection ID</em>, <em>item ID</em>, <em>position</em>) <br>
<em>Description:</em> Changes the order of an item in the Collection. If Collection does not exist, response code is 404 with body { &quot;message&quot;: &quot;Collection not found.&quot; } is returned. If the Position parameter is not valid within the collection, response code 500 with body { &quot;message&quot;: &quot;Invalid position specified&quot; } is returned.
(Note: The position parameter is a zero-based numerical value that indicates the desired position of the item in the collection. </p>

<div><pre><code class="language-none">Example:
    GET mflyCommands.reorderItemInCollection(&quot;collection2id&quot;, &quot;item4id&quot;, 0);</code></pre></div>

<p><em>Availability:</em>  iOS, Android, Web Viewer, Win/Mac</p>

<h4 id="toc_56">Rename a Collection</h4>

<p><em>mflyCommands.js:</em> mflyCommands.renameCollection(<em>collection ID</em>, <em>name</em>) <br>
<em>Description:</em> Changes the name of the collection. If Collection does not exist, response code is 404 with body { &quot;message&quot;: &quot;Collection not found.&quot; } is returned. If the Position parameter is not valid within the collection, response code 500 with body { &quot;message&quot;: &quot;Invalid slug specified&quot; } is returned.</p>

<div><pre><code class="language-none">Example:
    GET mflyCommands.renameCollection(&quot;collection2id&quot;, &quot;New Name&quot;);</code></pre></div>

<p><em>Availability:</em>  iOS, Android, Web Viewer, Win/Mac</p>

<h3 id="toc_57">Share Links</h3>

<p>An Extension can get a share link for an item.
<em>mflyCommands.js:</em> mflyCommands.getShare(<em>item ID</em>) <br>
<em>Description:</em> Returns an object that indicates whether the item is shareable or not. If the item is shareable, the share link is also provided.</p>

<div><pre><code class="language-none">Example:
    GET mflyCommands.getShare(&quot;item4id&quot;);
    Result:
    {
        &quot;shareable&quot;: true,
        &quot;url&quot;: &quot;https://assets.mediafly.com/shares/v?e=4hGCVQ2MYt7uO4%2fJbY67EC%2fcjC%2f1TZRiY2gKZV0HKdBON2%2fX8BL4qWJcNCAdwShBDf225NKtucVOuQ0OmMR4O4%2fZNe31JPtAI8OBBHV0kVk%3d&quot;
    }</code></pre></div>

<p><em>Availability:</em>  iOS, Android, Web Viewer, Win/Mac</p>

<h4 id="toc_58">Show &quot;Collections&quot; (<em>deprecated</em>)</h4>

<p><em>mflyCommands.js:</em> mflyCommands.showCollections(<em>x-coord, y-coord, width, height</em>) <br>
<em>Description:</em> Shows the Collections dialog at x-coord, y-coord coordinates with specified width and height. Parameters x-coord, y-coord, width, and height are all optional, and only work with iOS.<br>
<em>Availability:</em> iOS, Android</p>

<h3 id="toc_59">Downloader</h3>

<p>Mediafly&#39;s apps have been optimized for very advanced synchronization and download use cases. We offer a set of Extensions calls to obtain information about downloads and control the app. </p>

<p><em>Note</em>: Downloading capability does not exist on Web Viewer.</p>

<h4 id="toc_60">Show Downloader (<em>deprecated</em>)</h4>

<p><em>mflyCommands.js:</em> mflyCommands.showDownloader(<em>x-coord, y-coord, width, height</em>) <br>
<em>Description:</em> Shows the Downloader dialog at x-coord, y-coord coordinates with specified width and height. Parameters x-coord, y-coord, width, and height are all optional, and only work with iOS. <br>
<em>Availability:</em> iOS, Android, Win/Mac</p>

<h4 id="toc_61">Get total download progress</h4>

<p><em>mflyCommands.js:</em> mflyCommands.getDownloadStatus() <br>
<em>Description:</em> Get total download progress, as a range between 0 (no downloads started) and 1 (all downloads complete), number of failed downloads, and number of downloads for whom storage has been exceeded. <br></p>

<div><pre><code class="language-none">Example:
    Result:
    {
      &quot;progress&quot;:0.12,
      &quot;fails&quot;:1,
      &quot;storageExceeded&quot;: 3
    }</code></pre></div>

<p><em>Availability:</em> iOS, Android, Win/Mac</p>

<h4 id="toc_62">Get download progress for a single item</h4>

<p><em>mflyCommands.js:</em> mflyCommands.getDownloadStatus(<em>id</em>) <br>
<em>Description:</em> Get download status for a single item. The attribute may be &quot;progress&quot; (download is progressing normally), &quot;error&quot; (download is in an error state), &quot;cellularExceeded&quot; (download won&#39;t proceed because the cellular limit set for the app has been exceeded; iOS only), or &quot;storageExceeded&quot; (download won&#39;t proceed because there is no more available storage on this device). <br></p>

<div><pre><code class="language-none">Example:
    Result:
    { &quot;progress&quot;: 0.34 }

Example:
    Result:
    { &quot;error&quot;: 0.34 }

Example:
    Result:
    { &quot;cellularExceeded&quot;: 0.34 }

Example:
    Result:
    { &quot;storageExceeded&quot;: true }</code></pre></div>

<p><em>Availability:</em> iOS, Android, Win/Mac</p>

<h4 id="toc_63">Add to Downloader</h4>

<p><em>mflyCommands.js:</em> mflyCommands.addToDownloader(<em>id</em>) <br>
<em>Description:</em> Instruct the app to add an item to the Downloader. Response code 200 = item was added to the Downloader. Response code 404 if id is not found.<br>
<em>Availability:</em> iOS, Android, Win/Mac</p>

<h4 id="toc_64">Remove from Downloader</h4>

<p><em>mflyCommands.js:</em> mflyCommands.removeFromDownloader(<em>id</em>) <br>
<em>Description:</em> Instruct the app to remove the item from the Downloader. Response code 200 = item was removed from the Downloader. Response code 404 if id is not found.<br>
<em>Availability:</em> iOS, Android, Win/Mac</p>

<h3 id="toc_65">Notifications</h3>

<p>When notifications are enabled for an app, users can subscribe or unsubscribe to/from emails on any folder. When new content appears in the folder, the system will email the user either instantly or at the end of the day in a digest of the availability of the new content. Extensions can control notifications with the following commands.</p>

<h4 id="toc_66">Get notification status for a folder</h4>

<p><em>mflyCommands.js:</em> mflyCommands.getNotificationStatus(<em>id</em>) <br>
<em>Description:</em> Get the notification status for a folder. If the folder is valid, response code is 200 and body is a JSON object similar to this:<br></p>

<div><pre><code class="language-none">Example:
    {
        &quot;notification&quot;:&quot;[status]&quot; // [status] is email|none
    }</code></pre></div>

<p><em>Availability:</em> iOS, Android, Win/Mac</p>

<h4 id="toc_67">Add a folder to notifications</h4>

<p><em>mflyCommands.js:</em> mflyCommands.addNotification(<em>id</em>) <br>
<em>Description:</em> Instruct the app to subscribe the folder for notifications. Response code 200 if successful, 304 if folder was already subscribed, and 500 if an error occurred.<br>
<em>Availability:</em> iOS, Android, Win/Mac</p>

<h4 id="toc_68">Remove a folder from notifications</h4>

<p><em>mflyCommands.js:</em> mflyCommands.removeNotification(<em>id</em>) <br>
<em>Description:</em> Instruct the app to unsubscribe the folder from notifications. Response code 200 if successful, 304 if folder was not already subscribed, and 500 if an error occurred.<br>
<em>Availability:</em> iOS, Android, Win/Mac</p>

<h4 id="toc_69">Show the notifications manager</h4>

<p><em>mflyCommands.js:</em> mflyCommands.showNotificationsManager(<em>x-coord, y-coord, width, height</em>) <br>
<em>Description:</em> Display the notifications manager. Parameters x-coord, y-coord, width, and height are all optional, and only work with iOS. <br>
<em>Availability:</em> iOS, Android, Win/Mac</p>

<h3 id="toc_70">GPS</h3>

<h4 id="toc_71">Request latitude/longitude</h4>

<p><em>mflyCommands.js:</em> mflyCommands.getGpsCoordinates() <br>
<em>Description:</em> Extensions can request latitude and longitude from the app. This is useful for apps that connect to external services to report lat/lon, or use the Haversine (Big Earth) formula to calculate rough distances.<br></p>

<div><pre><code class="language-none">Example:
    Response:
    {
      latitude: 41.851231,
      longitude: -87.652345
    }</code></pre></div>

<p><em>Availability:</em> iOS, Android</p>

<h3 id="toc_72">Get Sync Status</h3>

<h4 id="toc_73">Get the current sync status</h4>

<p><em>mflyCommands.js:</em> mflyCommands.getSyncStatus() <br>
<em>event:</em> document.mflySyncStatus<br>
<em>Description:</em> Extensions can get the current sync status from the app. This information can be retrieved by calling the URL or listening to the event published by the app. Extensions can leverage information about content being snced and wait to load certain parts of the UI. Extensions can also display progress indicators and spinners based on the syncStatus.  <br></p>

<div><pre><code class="language-none">Example:
    Response:
    {
      complete: 26,
      total: 28,
      isrunning: true
    }</code></pre></div>

<p><em>Availability:</em> iOS, Android, Win/Mac</p>

<h3 id="toc_74">Log out</h3>

<h4 id="toc_75">Instruct the app to log out</h4>

<p><em>mflyCommands.js:</em> mflyCommands.logout() <br>
<em>Description:</em> When an Extension makes this call, the app will log the current user out by de-authenticating them. The calling Extension will be closed and the app will leave the user bound (user can enter their PIN to log back in). The app will navigate to the log in screen. If the customer environment does not support PIN, you may receive a 500 error.<br></p>

<p><em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<h3 id="toc_76">Get Online Status</h3>

<p><em>mflyCommands.js:</em> mflyCommands.getOnlineStatus() <br></p>

<p><em>Description:</em> Check whether the device is online<br>
Example:</p>

<div><pre><code class="language-none">Response:
{
  &quot;status&quot;: &quot;online&quot;
}</code></pre></div>

<p>Respnose when the device is offline:</p>

<div><pre><code class="language-none">{
  &quot;status&quot;: &quot;offline&quot;
}</code></pre></div>

<p><em>Availability:</em> iOS, Android, Win/Mac</p>

<h3 id="toc_77">Posting Arbitrary Events</h3>

<p>Extensions can post arbitrary events that are recorded by the Mediafly backend for analytics purposes. An event is identified by a key which is a string. Optinally, you can submit additional information about the items as the properties parameter.</p>

<p><em>mflyCommands.js:</em> mflyCommands.postEvent(key, properties) <br></p>

<p><em>Description:</em> Post an event to the app<br>
Example:</p>

<div><pre><code class="language-none">mflyCommands.postEvent(&#39;myEvent&#39;, { eventInfo: &#39;user performed action&#39; })
Response: null</code></pre></div>

<p><em>Availability:</em> iOS, Android, Viewer, Win/Mac</p>

<hr>

<h2 id="toc_78">Being controlled by the app</h2>

<p>Mediafly&#39;s apps send many kinds of events into the Extension. These events can be listened to by the Extension reactively, and the Extension can then take action. These capabilities are only availble to the native apps, not to web Viewer.</p>

<p>There are two methods in which this happens:</p>

<ol>
<li>The old way. If an appropriately named JavaScript function is defined, they will be called by the app at the appropriate time, and the Extension can take action. If the function does not exist, the console log will show a &quot;function not defined&quot; error and the Extension will continue execution.</li>
<li>The new way. Recently created features will make use of JavaScript events in the DOM&#39;s document object. This better matches how other JavaScript frameworks similar to Extensions are structured.</li>
</ol>

<p>Each feature listed below indicates which method it uses.</p>

<h3 id="toc_79">mflyDataInit (<em>deprecated</em>)</h3>

<p><b>PLEASE NOTE:</b> Use mflyCommands.getInteractiveInfo where possible.</p>

<p>This function has two uses:</p>

<ol>
<li>Receive configuration information from the app, and</li>
<li>Send configuration parameters to the app</li>
</ol>

<h4 id="toc_80">Use 1: Receive configuration information from the app</h4>

<p>Extensions can implement mflyDataInit, using method 1.</p>

<div><pre><code class="language-none">    function mflyDataInit(obj) {
        // obj = JSON object that contains initial configuration
    }</code></pre></div>

<p>mflyDataInit will be called with a JSON object that contains initial configuration.  E.g. on iOS, params may be a JSON Object such as this:</p>

<div><pre><code class="language-none">    {
        &quot;mflyInitVersionMaximum&quot;: &quot;2&quot;,
        &quot;user&quot;: &quot;jshah@mediafly.com&quot;,
        &quot;displayName&quot;: &quot;Jason Shah&quot;,
        &quot;item&quot;: &quot;Custom Dynamic Extension 1.2&quot;,
        “id”: “29342938241238product234234”,
        &quot;osType&quot;: &quot;iOS&quot;,
        &quot;osVersion&quot;: &quot;6.1.2&quot;,
        &quot;appVersion&quot;: &quot;6.1.4.405&quot;,
        &quot;deviceId&quot;: &quot;4639ufu115f0630a13a8744e8b5cc6309b46&quot;,
        &quot;lastUpdated&quot;: &quot;2014-02-03T07:04:07-06:00&quot;
    }</code></pre></div>

<p><em>Supported parameters:</em><br></p>

<ul>
<li>mflyInitVersionMaximum: indicates how many possible values mflyInitVersion can have in the return value (see below).</li>
<li>user: user_context (essentially, system-known username)</li>
<li>displayName: display name. Can be email, first+last, or something similar</li>
<li>item: title of this Extension</li>
<li>id: the slug (unique id) of this Extension within Airship</li>
<li>osType: which OS (iOS, Android, Windows 8)</li>
<li>osVersion: which version of the OS</li>
<li>appVersion: which version of the app</li>
<li>deviceId: the unique device ID for this device</li>
<li>lastUpdated: the lasted updated time. This is good for debugging purposes, to help you identify which version of the Extension you are looking at on the device</li>
</ul>

<h4 id="toc_81">Use 2: Send configuration parameters to the app</h4>

<p>Optionally, Extensions can then return a JSON Object with specifics on how the app should behave.  E.g. on iOS, return value may be a JSON Object such as this:</p>

<div><pre><code class="language-none">    {
      “mflyInitVersion”: “4”,
      “mflyWideScreenSupport”: true
    }</code></pre></div>

<p><em>Supported parameters:</em><br></p>

<ul>
<li><p>mflyInitVersion: indicates which version of mflyInit should be called by the app. Android supports versions 3, 4, and 5 of mflyInitVersion. Windows 8 supports only version 3 and 4 of mflyInit. If ignored, defaults to &quot;4&quot;.</p>

<ul>
<li>&quot;2&quot;: default version reflected in this documentation. Supported on iOS.</li>
<li>&quot;3&quot;: On iOS, sharing status is represented by canShare, canAccessAssetOffline, and canDownloadAsset. Supported on Android, iOS, and Windows8.</li>
<li>&quot;4&quot;: No longer sends down mflyInit. mflyInit is deprecated and causes undo burden when content libraries are large, and we plan to deprecate it in the future. Supported on Android, iOS and Windows 8.</li>
</ul></li>
<li><p>mflyWideScreenSupport: if true, this makes the app aware that the Extension can handle widescreen second screens (HDMI, Apple TV).  This is specifically for the case where the Extension has been designed to be a presentation-worthy UI for second screens. Only available on iOS.</p></li>
</ul>

<p><em>Example:</em><br></p>

<div><pre><code class="language-none">function mflyDataInit(obj) {
    // Do initialization
    return &#39;{ &quot;mflyInitVersion&quot; : &quot;4&quot; }&#39;;
}</code></pre></div>

<p><em>Availability:</em> iOS, Android, Windows 8. Not all parameters will be available on Android or Windows 8.</p>

<h3 id="toc_82">mflyResume</h3>

<p>The app calls this function when the app opens and shows the Extension.  If you need to start animation or take other action when the Extension shows, this is the place to do it.</p>

<p><em>Example:</em><br></p>

<div><pre><code class="language-none">function mflyResume() {
    // Handle mflyResume
}</code></pre></div>

<p><em>Availability:</em> iOS, Android</p>

<h3 id="toc_83">mflyPause</h3>

<p>The app calls this function when the user hides the Extension. If you need to stop animation, submit a form, or take other action when the Extension hides, this is the place to do it.</p>

<p><em>Example:</em><br></p>

<div><pre><code class="language-none">function mflyPause() {
    // Handle mflyPause
}</code></pre></div>

<p><em>Availability:</em> iOS, Android</p>

<h3 id="toc_84">Sync Status</h3>

<p>Our apps are built to automatically sync all folders on launch and at regular intervals. Sometimes, the Extension needs to know about the status of sync to ensure that sufficient content is loaded before rendering the Extension. To receive information about the status of sync, apps can listen to events injected into the DOM&#39;s document object, and react to those events.</p>

<p><em>Example:</em><br></p>

<div><pre><code class="language-none">document.addEventListener(&quot;mflySyncStatus&quot;, function(d) {
    if (d &amp;&amp; d.detail) {
        // Handle Sync Status
        $(&quot;#syncEventHandlerResult&quot;).html(JSON.stringify(d.detail, null, 2));
    }
}, false);</code></pre></div>

<p>The detail attribute of the event object will be structure as JSON with 2-3 fields, like so:</p>

<div><pre><code class="language-none">{
    complete: 26,
    total: 28,
    isrunning: true
}</code></pre></div>

<p>where the JSON object&#39;s attributes have the following meaning:</p>

<ul>
<li>complete: the number of folders that have been synced</li>
<li>total: the total number of folders known to the app. Note that this may not be defined immediately on application start, and may change if there are dramatic changes of what is available to the user.</li>
<li>isrunning: true|false, indicating whether the sync is currently running.</li>
</ul>

<p><em>Availability:</em> iOS (604), Android (2.23.59)</p>

<h3 id="toc_85">mflyInit (<em>deprecated</em>)</h3>

<p><b>PLEASE NOTE</b>: mflyInit is deprecated. We have discovered that, as content libraries become incredibly large, mflyInit consumes an excessive amount of memory. As a result, we strongly suggest using mflyCommands.getFolder() and mflyCommands.getItem() to selectively construct the hierarchy that is needed at that time.</p>

<p>The app calls this function when the app launches an Extension.  The parameter is a dictionary of JSON objects that represent a flattened version of the full hierarchy of folders and items available to the user. The key of each entry is the item/folder slug. Each entry for folders contains a JSON Array called “items”, which contains an array of slugs that are children of this folder.</p>

<p>For example, if a user has the following hierarchy:</p>

<div><pre><code class="language-none">  folder [id=slug1]
    item [id=slug2]
    folder [id=slug3]
      item [id=slug4]</code></pre></div>

<p>then the object may look like this:</p>

<div><pre><code class="language-none">{
  “version”: 2,
  “slug1” : {
    &quot;id&quot;: &quot;slug1&quot;,
    “items”: [“slug2”, “slug3”],
    &quot;url&quot;: &quot;mfly://folder/slug1&quot;,
    &quot;type&quot;: &quot;folder&quot;,
    &quot;name&quot;: &quot;Name&quot;,
    &quot;description&quot;: &quot;Description&quot;,
    &quot;date&quot;: &quot;2010-11-12T06:15:15:00-06:00&quot;,
    &quot;received&quot;: &quot;2012-12-19T16:45:14:00-06:00&quot;,
    &quot;thumbnailUrl&quot;: &quot;mfly://image/123&quot;,
    &quot;launched&quot;: &quot;false&quot;,
    “keywords”: [“keyword1”, “keyword2”, “keyword3”],
    “new”: 1
  },
  “slug2” : {
    &quot;id&quot;: &quot;slug2&quot;,
    &quot;url&quot;: &quot;mfly://item/slug2&quot;,
    &quot;type&quot;: &quot;video&quot;,
    &quot;name&quot;: &quot;Name&quot;,
    &quot;description&quot;: &quot;Description&quot;,
    &quot;date&quot;: &quot;2010-11-12T06:15:15:00-06:00&quot;,
    &quot;received&quot;: &quot;2012-12-19T16:45:14:00-06:00&quot;,
    &quot;thumbnailUrl&quot;: &quot;mfly://image/123&quot;,
    &quot;launched&quot;: &quot;true&quot;,
    “keywords”: [“keyword4”],
    “downloadModel”: “DownloadableShareable”
  },
  “slug3” : {
    &quot;id&quot;: &quot;slug3&quot;,
    “items”: [“slug4”],
    &quot;url&quot;: &quot;mfly://folder/slug3&quot;,
    &quot;type&quot;: &quot;folder&quot;,
    &quot;name&quot;: &quot;Name&quot;,
    &quot;description&quot;: &quot;Description&quot;,
    &quot;date&quot;: &quot;2010-11-12T06:15:15:00-06:00&quot;,
    &quot;received&quot;: &quot;2012-12-19T16:45:14:00-06:00&quot;,
    &quot;thumbnailUrl&quot;: &quot;mfly://image/123&quot;,
    &quot;launched&quot;: &quot;false&quot;
  },
  “slug4” : {
    &quot;id&quot;: &quot;slug4&quot;,
    &quot;url&quot;: &quot;mfly://item/slug4&quot;,
    &quot;type&quot;: &quot;interactive&quot;,
    &quot;name&quot;: &quot;Name&quot;,
    &quot;description&quot;: &quot;Description&quot;,
    &quot;date&quot;: &quot;2010-11-12T06:15:15:00-06:00&quot;,
    &quot;received&quot;: &quot;2012-12-19T16:45:14:00-06:00&quot;,
    &quot;thumbnailUrl&quot;: &quot;mfly://image/123&quot;,
    &quot;launched&quot;: &quot;true&quot;,
    “new”: 1,
    “downloadModel”: “DownloadableProtected”
  }
}</code></pre></div>

<p>This function and mflyResume exist in harmony.  mflyInit is called on launch of the Extension. mflyResume is called on both launch and resume of the Extension.</p>

<p>Expect mflyInit to be called many times for large hierarchies, as often as every 2-3 seconds. Consider processing the results of the mflyInit object in parallel. Imagine in the worst case an mflyInit object with 10,000 items, called every 2-3 seconds. If processing that object occurred synchronously, the Extension would grind to a halt or crash with out of memory errors.</p>

<p>Parameter definitions:</p>

<ul>
<li>version: mflyInit uses this version to indicate what the structure of mflyInit looks like. See mflyDataInit for possible versions and what they mean.</li>
<li>items: a list of slugs of the children of this item (if the item is a folder and has any children). This is used to construct the hierarchy</li>
<li>type: can be one of “Audio”, “Video”, “image”, “pdf”, “zip”, “ibooks”, “html”, “youtube”, “keynote”, “png”, “jpeg”, “jpg”, “gif”, “tif”, “tiff”</li>
<li>received: the UTC datetime for when the app received this version of the item.</li>
<li>launched: whether the user has launched this item in the past.</li>
<li>new: for folders, number of items within that folder that are defined as “new” based on client’s business rules. For items, if 1, that item is considered “new”. [iOS 425+]</li>
<li>keywords: any keywords the user set, as a JSON array.</li>
<li>downloadModel: indicates whether the app will allow you to email this item. If downloadModel=DownloadableShareable, this item can be emailed. All other values indicate that the item cannot be emailed. This is visible if mflyDataInit.mflyInitVersion is set to 2.</li>
<li>canShare: indicates whether the app will allow you to email this item. This is available if mflyDataInit.mflyInitVersion &gt;= 3.</li>
<li>canAccessAssetOffline: indicates whether the item is allowed to be downloaded and stored encrypted, per business rules. Applies to video, documents, audio and images. This is available if mflyDataInit.mflyInitVersion &gt;= 3.</li>
<li>canDownloadAsset: indicates whether the app is allowed to download the item and open it in an external application, unencrypted. Applies to e.g. iBooks, KeyNote, Excel. This is available if mflyDataInit.mflyInitVersion &gt;= 3.</li>
</ul>

<p>All dates are specified in ISO 8601 format.</p>

<p><em>Example:</em></p>

<div><pre><code class="language-none">function mflyInit(obj) {
    // Handle mflyInit object
}</code></pre></div>

<p><em>Availability:</em> iOS, Android, Windows 8</p>

<hr>

<h2 id="toc_86">Saving and retrieving locally persisted key/value data</h2>

<p>Extensions can save data to and retrieve data from the app with AJAX. This is useful for persisting data within or between Extensions. After saving, you can be sure that your data will be saved if the user restarts the app or device (and, soon, uninstalls/reinstalls the app). You can use any key you wish, which provides a lot of flexibility, but please consider providing a namespace within your keys. Otherwise, two Extensions may find ways to clobber each others’ keys.</p>

<p>For iOS, Android and Windows 8, key/value data is isolated by user, by app. So, two users cannot share keys, and two apps cannot share keys. Furthermore, currently all key/value data is stored on the device. So, uninstalling the app will remove all saved keys.</p>

<p>For web Extensions, key/value data is stored in Local Storage. There is no isolation provided at the moment for the data. It is advised that you prefix your keys if there is a chance that the key will be accessed from multiple environments or users. Once syncronizing of this data to servers is available, prefixing will no longer be necessary.</p>

<p>If your Extension needs to persist data on the server, please see the section <code>Saving and retrieving synchronized key/value data</code> below.</p>

<h3 id="toc_87">Save data</h3>

<p>To save data to the app container, call mflyCommands.putValue(<em>key, value</em>), where <em>key</em> is the key you wish to save, and <em>value</em> is the value for that key.</p>

<p><em>Example:</em><br>
This example saves key/value data, using mflyCommands.js.</p>

<div><pre><code class="language-none">var key = $(&#39;#key&#39;).val();
var value = { name: ‘abc’, value: ‘def’ };

mflyCommands.putValue(key, value)
    .done(function(data, status) {
        // Success! Do something.
    })
    .fail(function(deferred, status) {
        // Error! Do something.
    });</code></pre></div>

<p>HTTP response codes:</p>

<ul>
<li>Response of 200 OK indicates a successful save to an existing key</li>
<li>Response of 201 Created indicates a successful save to a new key</li>
<li>Response of 400 Bad Request is returned if the value has not been previously saved</li>
</ul>

<p>(Note: attempts were made to use HTTP PUT verbs, but iOS seems to strip out the body of the PUT, so we migrated to use GET instead).</p>

<p><em>Example:</em><br>
This example saves key/value data, using jQuery.</p>

<div><pre><code class="language-none">var key = $(&#39;#key&#39;).val();
var value = { name: ‘abc’, value: ‘def’ };

$.ajax({
    type: &quot;GET&quot;,
    url: &quot;mfly://data/info/&quot; + key,
    contentType: &quot;text/plain; charset=utf-8&quot;,
    data: &quot;value=&quot; + encodeURIComponent(JSON.stringify(value)) + &quot;&amp;method=PUT&quot;,
    dataType: &quot;text&quot;,
    success: function(result, status, xhr) {
        // Success! Do something.
    },
    error: function(xhr) {
        // Error! Do something.
    }
});</code></pre></div>

<p><em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<h3 id="toc_88">Retrieve data</h3>

<p>You can retrieve value information from keys in multiple ways using mflyCommands.js.</p>

<p>Alternatively, you can make the calls directly with AJAX, but we strongly recommend using mflyCommands instead. When making calls directly,</p>

<ul>
<li>Response of 200 OK indicates a successful get of an existing key. The body of the response will contain the values indicated below.</li>
<li>Response of 404 Not Found indicates that the key does not exist</li>
</ul>

<h4 id="toc_89">Single key</h4>

<p>To get data for a specific key from the app container, use mflyCommands.getValue(<em>key</em>).</p>

<p><em>Example:</em></p>

<div><pre><code class="language-none">// Assume key &#39;abc&#39; has been set to value &#39;123&#39;.

mflyCommands.getValue(&#39;abc&#39;)
    .done(function(data, status) {
        // Success! Do something.
        console.log(data);
    })
    .fail(function(deferred, status) {
        // Error! Do something.
    });

// Console output: 123</code></pre></div>

<p>On successful retrieval, data will contain the value of the key.</p>

<h4 id="toc_90">All keys</h4>

<p>To get data for all keys from the app container, use mflyCommands.getValues().</p>

<p><em>Example:</em></p>

<div><pre><code class="language-none">// Assume key &#39;abc&#39; has been set to value &#39;123&#39;, and key &#39;def&#39; has been set to value &#39;456&#39;.

mflyCommands.getValues()
    .done(function(data, status) {
        // Success! Do something.
        console.log(data);
    })
    .fail(function(deferred, status) {
        // Error! Do something.
    });

// Console output: { &quot;abc&quot;: &quot;123&quot;, &quot;def&quot;: &quot;456&quot; }</code></pre></div>

<p>On successful retrieval, body will contain a JSON object enumerating all keys and values, as shown above.</p>

<h4 id="toc_91">Key prefix</h4>

<p>To get data for all keys that begin with X, use mflyCommands.getValues(<em>prefix</em>). On successful retrieval, data will contain a JSON object enumerating all keys and values where the keys begin with X.</p>

<p><em>Example:</em></p>

<div><pre><code class="language-none">// Assume:
//   key &#39;snow&#39; has been set to value &#39;white&#39;,
//   key &#39;snowball&#39; has been set to value &#39;round&#39;,
//   key &#39;fire&#39; has been set to value &#39;red&#39;

mflyCommands.getValues(&#39;snow&#39;)
    .done(function(data, status) {
        // Success! Do something.
        console.log(data);
    })
    .fail(function(deferred, status) {
        // Error! Do something.
    });

// Console output: { &quot;snow&quot;: &quot;white&quot;, &quot;snowball&quot;: &quot;round&quot; }

mflyCommands.getValues(&#39;abc&#39;)
    .done(function(data, status) {
        // Success! Do something.
        console.log(data);
    })
    .fail(function(deferred, status) {
        // Error! Do something.
    });

// Console output: {}</code></pre></div>

<p><em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<h3 id="toc_92">Delete data</h3>

<p>To delete a key/value pair by key from the app container, use mflyCommands.deleteKey(<em>key</em>).</p>

<p><em>Example:</em></p>

<div><pre><code class="language-none">// Assume key &#39;abc&#39; has been set to value &#39;123&#39;.

mflyCommands.deleteKey(&#39;abc&#39;)
    .done(function(data, status) {
        // Success! Do something.
        console.log(&#39;abc has been deleted&#39;);
    })
    .fail(function(deferred, status) {
        // Error! Do something.
    });

// Console output: &#39;abc has been deleted&#39;</code></pre></div>

<p><em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<hr>

<h2 id="toc_93">Saving and retrieving synchronized key/value data</h2>

<p>Synchronized key/value storage allows Extensions to persist key/value pairs that are saved on Mediafly servers in addition to being stored on devices. This is useful for persisting data within or between Extensions, and between devices. After saving, you can be sure that your data will be saved if the user restarts the app or device, and, uninstalls/reinstalls the app. You can use any key you wish, which provides a lot of flexibility, but please consider providing a namespace within your keys. Otherwise, two Extensions may find ways to clobber each others’ keys.</p>

<p>Key/value data is isolated by user, by app. So, two users cannot share keys, and two apps cannot share keys. Furthermore, all key/value data is stored on the device as well as the server. So, uninstalling and reinstalling the app will still restore all data from the server to the device..</p>

<h3 id="toc_94">Save data</h3>

<p>To save data to the app container, call mflyCommands.putSyncedValue(<em>key, value</em>), where <em>key</em> is the key you wish to save, and <em>value</em> is the value for that key.</p>

<p><em>Example:</em><br>
This example saves key/value data, using mflyCommands.js.</p>

<div><pre><code class="language-none">var key = $(&#39;#key&#39;).val();
var value = { name: ‘abc’, value: ‘def’ };

mflyCommands.putSyncedValue(key, value)
    .done(function(data, status) {
        // Success! Do something.
    })
    .fail(function(deferred, status) {
        // Error! Do something.
    });</code></pre></div>

<p>HTTP response codes:</p>

<ul>
<li>Response of 200 OK indicates a successful save to an existing key</li>
<li>Response of 201 Created indicates a successful save to a new key</li>
<li>Response of 400 Bad Request is returned if the value has not been previously saved</li>
</ul>

<p><em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<h3 id="toc_95">Retrieve synchronized data</h3>

<p>You can retrieve value information from keys in multiple ways using mflyCommands.js.</p>

<p>Alternatively, you can make the calls directly with AJAX, but we strongly recommend using mflyCommands instead. When making calls directly,</p>

<ul>
<li>Response of 200 OK indicates a successful get of an existing key. The body of the response will contain the values indicated below.</li>
<li>Response of 404 Not Found indicates that the key does not exist</li>
</ul>

<h4 id="toc_96">Single key</h4>

<p>To get data for a specific key from the app container, use mflyCommands.getSyncedValue(<em>key</em>).</p>

<p><em>Example:</em></p>

<div><pre><code class="language-none">// Assume key &#39;abc&#39; has been set to value &#39;123&#39;.

mflyCommands.getSyncedValue(&#39;abc&#39;)
    .done(function(data, status) {
        // Success! Do something.
        console.log(data);
    })
    .fail(function(deferred, status) {
        // Error! Do something.
    });

// Console output: 123</code></pre></div>

<p>On successful retrieval, data will contain the value of the key.</p>

<h4 id="toc_97">All keys</h4>

<p>To get data for all keys from the app container, use mflyCommands.getSyncedValues().</p>

<p><em>Example:</em></p>

<div><pre><code class="language-none">// Assume key &#39;abc&#39; has been set to value &#39;123&#39;, and key &#39;def&#39; has been set to value &#39;456&#39;.

mflyCommands.getSyncedValues()
    .done(function(data, status) {
        // Success! Do something.
        console.log(data);
    })
    .fail(function(deferred, status) {
        // Error! Do something.
    });

// Console output: { &quot;abc&quot;: &quot;123&quot;, &quot;def&quot;: &quot;456&quot; }</code></pre></div>

<p>On successful retrieval, body will contain a JSON object enumerating all keys and values, as shown above.</p>

<h4 id="toc_98">Key prefix</h4>

<p>To get data for all keys that begin with X, use mflyCommands.getSyncedValues(<em>prefix</em>). On successful retrieval, data will contain a JSON object enumerating all keys and values where the keys begin with X.</p>

<p><em>Example:</em></p>

<div><pre><code class="language-none">// Assume:
//   key &#39;snow&#39; has been set to value &#39;white&#39;,
//   key &#39;snowball&#39; has been set to value &#39;round&#39;,
//   key &#39;fire&#39; has been set to value &#39;red&#39;

mflyCommands.getSyncedValues(&#39;snow&#39;)
    .done(function(data, status) {
        // Success! Do something.
        console.log(data);
    })
    .fail(function(deferred, status) {
        // Error! Do something.
    });

// Console output: { &quot;snow&quot;: &quot;white&quot;, &quot;snowball&quot;: &quot;round&quot; }

mflyCommands.getSyncedValues(&#39;abc&#39;)
    .done(function(data, status) {
        // Success! Do something.
        console.log(data);
    })
    .fail(function(deferred, status) {
        // Error! Do something.
    });

// Console output: {}</code></pre></div>

<p><em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<h3 id="toc_99">Delete data</h3>

<p>To delete a key/value pair by key from the app container, use mflyCommands.deleteSyncedKey(<em>key</em>).</p>

<p><em>Example:</em></p>

<div><pre><code class="language-none">// Assume key &#39;abc&#39; has been set to value &#39;123&#39;.

mflyCommands.deleteSyncedKey(&#39;abc&#39;)
    .done(function(data, status) {
        // Success! Do something.
        console.log(&#39;abc has been deleted&#39;);
    })
    .fail(function(deferred, status) {
        // Error! Do something.
    });

// Console output: &#39;abc has been deleted&#39;</code></pre></div>

<p><em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<hr>

<h2 id="toc_100">Emailing content from Extensions</h2>

<h3 id="toc_101">Overview</h3>

<p>Extensions can have Mediafly&#39;s backend send emails with attachments. Attachments are Base64 encoded URLs.
Even though emails are sent from Mediafly&#39;s servers, they have &quot;Reply-To&quot; field populated with the curent logged in user&#39;s email address.</p>

<p><em>Example</em></p>

<div><pre><code class="language-none">mflyCommands.sendEmail({
    to: &#39;[to email address]&#39;,
    subject: &#39;[email subject]&#39;,
    body: &#39;[email body]&#39;,
    attachments: [{
        filename: &quot;[name of the attachment. for example: Presentation.pdf]&quot;,
        dataUrl: &quot;[Base64 encoded URL]&quot;
    }]
}).done(function(data, status) {
    // Success! Do something.
    console.log(&#39;email has been sent successfully&#39;);
})
.fail(function(deferred, status) {
    // Error! Do something.
    console.log(&#39;error sending email&#39;);
});</code></pre></div>

<p><em>Availability</em>: iOS (654), Android (2.29.07), Web Viewer, Win/Mac (1.0.92)</p>

<hr>

<h2 id="toc_102">Embedding images, other Extensions, or pages of documents</h2>

<h3 id="toc_103">Overview</h3>

<p>Extensions have the ability to embed items that exist in the app into it.  This is used for four primary purposes:</p>

<ul>
<li>Retrieve an item that contains structured data (JSON, XML, CSV)</li>
<li>Embed an item that is an image and render it as an image in this Extension</li>
<li>Embed another Extension into an iframe on this Extension</li>
<li>Embed a page from a PowerPoint, PDF, or Word document</li>
</ul>

<p>Embedding other types (audio, video, URLs) will have unexpected results. The best user experience will be provided to the user only if embedding is limited to data, images, documents and Extensions.</p>

<ul>
<li>To retrieve a data item, use <code>mflyCommands.getData(id)</code>, where <em>id</em> is the ID of the data item you wish to obtain.</li>
<li>To embed an image, create an <code>&lt;img&gt;</code> that refers to a loading image. In JavaScript, call <code>mflyCommands.embed($element, id)</code>, where <em>$element</em> is a jQuery reference to the img element, and <em>id</em> is the Airship id of the image item.

<ul>
<li>You can also use <code>mflyCommands.embedImage($element, id, options)</code> and supply dimensions for the image to be embedded (only supported on Web Viewer and requires mflyCommands.js version 1.4.10). This can be particularly helpful to scale down high resolution images to so browsers can load them quicker. <em>options</em> are defined as:

<ul>
<li><em>size</em> (string):   format is WxH (e.g. &quot;200x200&quot;)</li>
<li><em>width</em> (number): Width of the image</li>
<li><em>height</em> (number): Height of the image</li>
<li><em>maxWidth</em> (number): Maximum width of the image</li>
<li><em>maxHeight</em> (number): Maximum height of the image</li>
<li><em>rotate</em> (number): Degree of rotation to apply to the image. Values of 0, 90, 180, 270, or 360 are acceptable.</li>
</ul></li>
</ul></li>
<li>To embed another Extension, construct an <code>&lt;iframe&gt;</code>. In JavaScript, call <code>mflyCommands.embed($element, id)</code>, where <em>$element</em> is a jQuery reference to the iframe element, and <em>id</em> is the Airship id of the other Extension.</li>
<li>To embed the page from a document as an image, create an <code>&lt;img&gt;</code> that refers to a loading image. In JavaScript, call <code>mflyCommands.embed($element, id, page)</code>, where <em>$element</em> is a jQuery reference to the img element, <em>id</em> is the Airship id of the image item, and <em>page</em> is the page number that you wish to embed.</li>
<li>Please note: if you are embedding an image asset for the web Viewer, please consider directly accessing the <code>resourceUrl</code> attribute instead of using <code>mflyCommands.embed</code>. This will improve loading speed, caching, and reduce network requests. See the <a href="#optional_changes">optional changes</a> section below.</li>
</ul>

<h3 id="toc_104">Example</h3>

<p>See our <a href="https://bitbucket.org/mediafly/mediafly-interactives-tools-and-examples/src/tip/examples/Embed%20and%20Data%20Items/Containing%20Interactive/?at=default">open-source &#39;Embed and Data Items&#39; Extension</a> for an excellent working example of all four types of Embed described above.</p>

<h3 id="toc_105">Technical details</h3>

<p>Here are the HTTP response codes by platform. Unfortunately, these are not all the same because of differing security limitations across platforms.</p>

<table>
<thead>
<tr>
<th>State</th>
<th>iOS</th>
<th>Android</th>
</tr>
</thead>

<tbody>
<tr>
<td>Item downloaded and ready</td>
<td>HTTP response code 301 (Redirect). Browser should automatically redirect to correct URL. Body contains retrieved data.</td>
<td>HTTP response code 200. Body contains retrieved data.</td>
</tr>
<tr>
<td>Item not already downloaded</td>
<td>HTTP response code 202 (Accepted), with Retry-After header set to number of seconds the Extension should wait before trying again. If not set, default to a reasonable value, like 5.</td>
<td>HTTP response code 200, with an empty body. Extension should retry after a reasonable number of seconds, like 5.</td>
</tr>
<tr>
<td>Item not found</td>
<td>HTTP response code 404 (Not found)</td>
<td>HTTP response code 404 (Not found)</td>
</tr>
</tbody>
</table>

<p>Please note that asking too many times may put the Downloader into a race condition, as each request will trigger the Downloader to poll and possibly start downloading again.  So, please be considerate and retry no more than once every few seconds.</p>

<p>As you can see, embedding requires care. You cannot assume that the embedded item is available yet, because it may be behind some longer items in the Downloader. Instead, you have to try to fetch the content and monitor response codes. This is why we suggest using mflyCommands.js as shown in the example above.</p>

<p><em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<h3 id="toc_106">Reporting when embedding pages</h3>

<p>Our Reporting system automatically captures who viewed what, when, and where, when using the native app that sits underneath the Extension. However, when you embed pages, the app loses that information and is unable to tell our systems about view data.</p>

<p>To inform our Reporting system of a page view, post a page view after the page has been shown to the user:</p>

<p><em>mflyCommands.js:</em> mflyCommands.postPageView(<em>item ID</em>, <em>page number</em>) <br>
<em>Description:</em> Posts the page view to the Mediafly Reporting system. Item ID is the id of the item, as seen in Airship. Page number is the page that was displayed (starting at page 1).
<em>Availability:</em> iOS</p>

<h3 id="toc_107">Reporting</h3>

<p>When building an Extension that implements its own navigation instead of relying on the, the Extension is responsible for notifying Mediafly&#39;s Reporting system.</p>

<p>To inform our Reporting system of various actions:</p>

<p><em>mflyCommands.js:</em> mflyCommands.postAction(options) <br>
<em>Description:</em> Posts the action to the Mediafly Reporting system. Options object supplied contains:
  - type (required): Type can one of the following: &quot;collection&quot;, &quot;document&quot;, &quot;navigation&quot; or &quot;search&quot;
  - id (required when type is not &quot;search&quot;): Item ID is the id of the item, as seen in Airship
  - term (required when type is &quot;search&quot;): search term used to perform a search</p>

<p><em>Availability:</em> iOS, Android, Web Viewer, Win/Mac</p>

<hr>

<h2 id="toc_108">Support widescreen on iOS</h2>

<h3 id="toc_109">Control</h3>

<p>When a user plugs into an HDMI dongle or connects via AirPlay, they can change the app to run in Second Screen mode.  When in this mode, the app can paint a canvas that uses the entire screen resolution (whereas, Mirroring mode restricts the TV/projector to a 4x3 output and adds black bars on the left and right).</p>

<p>TODO: Add screenshots of what this looks like</p>

<p>To support this mode in an Extension, the Extension must do a few things.</p>

<ol>
<li><p>On the app call to mflyDataInit, the object returned must have mflyWideScreenSupport set:</p>

<div><pre><code class="language-none">{
  “mflyWideScreenSupport”: true
  ...
}</code></pre></div>

<p>Other parameters may exist in this JSON object, of course, but mflyWideScreenSupport is the key to initiate proper app support for widescreen.</p></li>
<li><p>If the app has sent mflyWideScreenSupport=true in mflyDataInit, the Extension should expect to receive a call from the app to mflyWideScreen(useWideScreen), where useWidescreen is either true or false.</p></li>
</ol>

<p><em>Example:</em><br></p>

<div><pre><code class="language-none">    &lt;script&gt;
        function mflyWideScreen(useWideScreen) {
            if (useWideScreen) {
                // Refresh the UI to show in 16x9 mode,
                // probably by adjusting CSS. On the iPad, black bars will
                // appear above and below the content.
            } else {
                // Refresh the UI to show in 4x3 mode on iPad only
            }
        }
    &lt;/script&gt;</code></pre></div>

<ol>
<li><p>(Optional) Create a button that the user taps to bring up the Second Screen Options dialog. This button in the Extension would mimic the button in the native app that allows the user to switch between iOS, Mirroring, and Second Screen. When tapped, the Extension should invoke:</p>

<div><pre><code class="language-none">mflyCommands.showSecondScreenOptions();</code></pre></div></li>
<li><p>(Optional) The app can be notified when the user flips second-screen mode on or off. When the user changes to/from second-screen mode, the app will call mflySecondScreenAvailable(bool), where bool is true or false. Apps can react to this call to render a button to invoke the Second Screen Options dialog.</p></li>
</ol>

<p><em>Example:</em><br></p>

<div><pre><code class="language-none">    function mflySecondScreenAvailable(isAvailable) {
        if (isAvailable) {
            // Second screen is now on/available.
            $(&quot;#secondScreenOptionsBtn&quot;).show();
        } else {
            // Second screen is no longer available.
            $(&quot;#secondScreenOptionsBtn&quot;).hide();
        }
    }</code></pre></div>

<h3 id="toc_110">UIWebKit Resolution</h3>

<p>When the iPad is displaying an Extension only on its canvas, the WebKit container is 1024 x 568.  When the iPad is projecting to Second Screen, the WebKit container shrinks to 960 x 540. This allows for the browser to efficiently scale up when connected to 720p and 1080p TVs.</p>

<p>To account for this, we suggest tagging the <body> element with a class that denotes either &quot;ipad&quot; or &quot;widescreen&quot;, and adjusting your layout and images based on this.  </p>

<p><em>Example:</em><br></p>

<ol>
<li><p>You may tag specific images or image types based on whether they are in second screen or not:</p>

<div><pre><code class="language-none">&lt;style&gt;
.ipad .carousel_image       { width: 1024px; height: 378px;
    background:url(&#39;image.png&#39;); background-size: 1024px 378px; }
.widescreen .carousel_image { width: 960px; height: 354px;
    background:url(&#39;&#39;image.png&#39;); background-size: 960px 354px; }
&lt;/style&gt;</code></pre></div></li>
<li><p>The body tag is initially decorated to be iPad-focused:</p>

<div><pre><code class="language-none">&lt;body class=&quot;ipad&quot;&gt;
...
&lt;/body&gt;</code></pre></div></li>
<li><p>When the user switches between Second Screen and Disabled, the <body> tag changes its class:</p>

<div><pre><code class="language-none">&lt;script&gt;
function mflyWideScreen(isWidescreen) {
    if (isWidescreen) {
        $(&quot;body&quot;).removeClass(&quot;ipad&quot;).addClass(&quot;widescreen&quot;);
    } else {
        $(&quot;body&quot;).removeClass(&quot;widescreen&quot;).addClass(&quot;ipad&quot;);
    }
}
&lt;/script&gt;</code></pre></div></li>
</ol>

<p><em>Note</em>: You will likely have to fix the container to 960x540 when in Widescreen. We have seen cases where, if the container is left to auto width/height, and the user invokes the keyboard on the iPad (say, a search field), a giant black space where that keyboard was appears on the second screen. We have seen this on iOS 7.0.x; it may have been corrected in iOS 7.1+ and may no longer be relevant.</p>

<p><em>Availability:</em> iOS</p>

<hr>

<h2 id="toc_111">Getting temporary credentials to communicate with Launchpad and Accounts APIs</h2>

<p>Launchpad API allows abilities such as uploading files, and updating items in Airship. If an Extensions wishes to leverage these capabilities, it need to be authenticated. Extensions can call <code>mflyCommands.getCredentials()</code> function to retrive the necessary credentials to access these APIs. The response from <code>getCredentials</code> contains a short lived access token. It is the Extension&#39;s responsibility to get a new token when the existing token expires (If an API endpoint returns a <code>401</code> HTTP response code, a new token should be retrieved). In addition to the token, <code>environmentId</code> is also returned which is necessary to make calls to the Launchpad API.</p>

<p><em>Example</em></p>

<div><pre><code class="language-none">mflyCommands.getCredentials();

Result:
{
    &quot;accessToken&quot;: &quot;token&quot;,
    &quot;environmentId&quot;: &quot;environmentId&quot;,
}</code></pre></div>

<p><em>Availability</em>: iOS (678), Android (2.29.47), Web Viewer, Win/Mac (1.0.101)</p>

<hr>

<h2 id="toc_112">Other useful information</h2>

<h3 id="toc_113">Stopping rubber band effects</h3>

<p>Since Extensions are embedded web pages, on some (particularly iOS) devices they tend to have a “rubber band” effect.  E.g. if touch-and-hold a part of the Extension, then drag it, the entire screen will follow your finger, then &quot;snap back&quot; after you let go.  This does not feel appropriate for an Extension, as users want the look and feel to be more native.</p>

<p>To address this, we recommend using <a href="http://eightmedia.github.io/hammer.js/">Hammer.js</a>, a mobile-focused touch gesture library.</p>

<p>We have created a detailed example within Mediafly Extensions Tools and Examples that demonstrates this, <a href="https://bitbucket.org/mediafly/mediafly-interactives-tools-and-examples/src/tip/examples/Swipe/app/?at=default">here</a>.</p>

<h3 id="toc_114">Smoother scrolling</h3>

<p>By default, iOS scrolling in the UIWebView is exactly controlled by your finger. You can drag the web view down and up, but you cannot &quot;throw&quot; the page in a direction. Furthermore, if you have a lot of large images on the page, scrolling can become choppy.</p>

<p>To alleviate this, consider implementing <code>-webkit-overflow-scrolling: touch</code> on your DOM nodes that handle scrolling. When set to touch, UIWebView uses native-style scrolling on your node.</p>

<h3 id="toc_115">Invoking an Extension with parameters (iOS)</h3>

<p>iOS support invocation URLS. An item can be linked to using these URLs.</p>

<p>Example: <a href="onmediafly://9cf282320e6340ee8b830e5376d54531product265958?param1=1&amp;param2=">onmediafly://9cf282320e6340ee8b830e5376d54531product265958?param1=1&amp;param2=2</a></p>

<p>This URL has the following format: [mcode]://[id]?[params...]</p>

<p>The iOS app will pass all supplied params to the Extension and the Extension can
retrieve them using JavaScript <code>window.location.search</code>.</p>

<hr>

<h1 id="toc_116">Appendix</h1>

<p>Additional information that doesn&#39;t fit very well elsewhere.</p>

<h2 id="toc_117">Supporting Extensions for the Web, Windows and Mac</h2>

<p>With Web Extensions, developers can now also support all major browsers and all major mobile platforms easily and cleanly.</p>

<h3 id="toc_118">How does it work?</h3>

<p>Web Extensions will be able to make use of the same delivery mechanism and API as Extensions available on iOS and Android today. When the user opens an Extension in the Web Viewer, the web server will:</p>

<ul>
<li>Unzip the Extension zip file</li>
<li>Point to index.html</li>
<li>Proxy requests to the Extensions API to the correct URL</li>
</ul>

<p>Provided that you are using mflyCommands.js, the API will remain largely unchanged. Only a few minor issues need to be addressed for you to take full advantage of Extensions on the Web.</p>

<h3 id="toc_119">Required changes</h3>

<p>The following changes need to be made to your existing Extensions to support Extensions on the Web:</p>

<ol>
<li><p><strong>Use mflyCommands.js, and keep it up to date</strong>. This should be your primary way to access our API. Don&#39;t make mfly:// calls to the API directly, as those simply will not work in web browsers.</p></li>
<li><p><strong>Don&#39;t assume a specific browser or size</strong>. The luxurious days of assuming latest Safari (iOS) or Google Chrome (Android 4.4+) are over. Build your Extension like you would a standard website, because, it can be opened on any browser like a standard website.</p></li>
<li><p>**Don&#39;t rely on mflyDataInit, rely on mflyCommands.getInteractiveInfo() **. Web Extensions will not call &quot;into&quot; the Extension. This means that mflyDataInit, mflySync, mflyResume, mflyPause, and mflyInit are not supported. Instead, make a new call once the document has been initialized: <code>mflyCommands.getInteractiveInfo()</code>. This asynchronous function will obtain the same information that mflyDataInit used to be called with, like so:</p>

<div><pre><code class="language-none">mflyCommands.getInteractiveInfo()
    .done(function(data) {
        // data contains a JSON object with information
        // about this app, user and Extension
    }).fail(function() {
        // handle failure
    });</code></pre></div></li>
<li><p>*** Don&#39;t include a file at the root of your Extension called mflyManifest.json***. We doubt you would, but if you do, it is likely to be overwritten by one of your apps as a part of the initialization process.</p></li>
<li><p><strong>Adjust mflyCommands.getFolder(id) call signature change</strong>. The call signature for mflyCommands.getFolder(id) has changed. Previously, if any of its items were also folders, it would return the items within the folders as an array of IDs. This has changed, and those subfolders no longer includes the items key at all. A separate mflyCommands.getFolder(id) call will have to be made on those children folders.</p></li>
<li><p><strong>Each URL should be able to establish its own state</strong>. Don&#39;t pass around variables like you would in a traditional application. This breaks on websites, and it will break on web Extensions.</p></li>
<li><p><strong>All resources must be accessed in a relative way</strong>. Don&#39;t try to construct absolute URLs to assets within your .zip file, as that path will undoutedly differ on other platforms.</p></li>
</ol>

<h3 id="toc_120">Optional changes</h3>

<p>The following changes will help improve performance for your Extensions when opened in the Web Viewer.</p>

<ol>
<li><p><strong>To render images, consider using the <code>resourceUrl</code> attribute and not mflyCommands.embed</strong>. The resourceUrl attribute can be found on mflyCommands.[getFolder, getItem, filter], and other calls that return full item models. The benefits are many:</p>

<ul>
<li>resourceUrl requests are more easily cached by browsers</li>
<li>resourceUrl requests return the original image in its original format (jpg, png, gif), with no transcoding</li>
<li>resourceUrl requests require one less redirect, which means faster load times</li>
</ul>

<p>There are downsides to using resourceUrl as well, however.</p>

<ul>
<li>Because resourceUrl (currently) only exists on the web Viewer, you will need to separate your approach of laying in images between our web Viewer and our mobile platforms.</li>
<li>If you need to ask Mediafly&#39;s servers to resize images, you will need to use mflyCommands.embed to do so, as resourceUrl returns the image as-is.</li>
</ul></li>
</ol>

<h2 id="toc_121">Constants</h2>

<p>The following constants can be used across customer environments or within an environment:</p>

<ul>
<li><code>__root__</code>: This is the ID of the top-level folder. It is consistent across all environments and all device platforms.</li>
<li><code>[environment ID]productmyitems</code>: This is the ID of the &quot;My Items&quot; folder. &quot;My Items&quot; is a folder that, when enabled, gives users a personal space to upload and manage their own content within the customer environment. In this case, <code>[environment ID]</code> is a unique 32-character string that is specific to that environment. Please contact Mediafly to obtain the string for your customers; or, simply use Get Folder on the <code>__root__</code> and look for My Items as the last folder in the response. In order to access My Items, the user must be logged in.</li>
</ul>




</body>

</html>
